{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { useState, useRef, useEffect } from 'react';\nimport addEventListener from \"rc-util/es/Dom/addEventListener\";\nimport { warning } from \"rc-util/es/warning\";\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"../previewConfig\";\nexport default function useMouseEvent(imgRef, movable, visible, scaleStep, transform, updateTransform, dispatchZoomChange) {\n  var rotate = transform.rotate,\n      scale = transform.scale,\n      x = transform.x,\n      y = transform.y;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isMoving = _useState2[0],\n      setMoving = _useState2[1];\n\n  var startPositionInfo = useRef({\n    diffX: 0,\n    diffY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n\n  var onMouseDown = function onMouseDown(event) {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    startPositionInfo.current = {\n      diffX: event.pageX - x,\n      diffY: event.pageY - y,\n      transformX: x,\n      transformY: y\n    };\n    setMoving(true);\n  };\n\n  var onMouseMove = function onMouseMove(event) {\n    if (visible && isMoving) {\n      updateTransform({\n        x: event.pageX - startPositionInfo.current.diffX,\n        y: event.pageY - startPositionInfo.current.diffY\n      }, 'move');\n    }\n  };\n\n  var onMouseUp = function onMouseUp() {\n    if (visible && isMoving) {\n      setMoving(false);\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n\n      var _startPositionInfo$cu = startPositionInfo.current,\n          transformX = _startPositionInfo$cu.transformX,\n          transformY = _startPositionInfo$cu.transformY;\n      var hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) return;\n      var width = imgRef.current.offsetWidth * scale;\n      var height = imgRef.current.offsetHeight * scale; // eslint-disable-next-line @typescript-eslint/no-shadow\n\n      var _imgRef$current$getBo = imgRef.current.getBoundingClientRect(),\n          left = _imgRef$current$getBo.left,\n          top = _imgRef$current$getBo.top;\n\n      var isRotate = rotate % 180 !== 0;\n      var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n\n      if (fixState) {\n        updateTransform(_objectSpread({}, fixState), 'dragRebound');\n      }\n    }\n  };\n\n  var onWheel = function onWheel(event) {\n    if (!visible || event.deltaY == 0) return; // Scale ratio depends on the deltaY size\n\n    var scaleRatio = Math.abs(event.deltaY / 100); // Limit the maximum scale ratio\n\n    var mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO); // Scale the ratio each time\n\n    var ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n\n  useEffect(function () {\n    var onTopMouseUpListener;\n    var onTopMouseMoveListener;\n    var onMouseUpListener;\n    var onMouseMoveListener;\n\n    if (movable) {\n      onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n      onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n\n      try {\n        // Resolve if in iframe lost event\n\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n          onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, \"[rc-image] \".concat(error));\n      }\n    }\n\n    return function () {\n      var _onMouseUpListener, _onMouseMoveListener, _onTopMouseUpListener, _onTopMouseMoveListen;\n\n      (_onMouseUpListener = onMouseUpListener) === null || _onMouseUpListener === void 0 || _onMouseUpListener.remove();\n      (_onMouseMoveListener = onMouseMoveListener) === null || _onMouseMoveListener === void 0 || _onMouseMoveListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseUpListener = onTopMouseUpListener) === null || _onTopMouseUpListener === void 0 || _onTopMouseUpListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseMoveListen = onTopMouseMoveListener) === null || _onTopMouseMoveListen === void 0 || _onTopMouseMoveListen.remove();\n    };\n  }, [visible, isMoving, x, y, rotate, movable]);\n  return {\n    isMoving: isMoving,\n    onMouseDown: onMouseDown,\n    onMouseMove: onMouseMove,\n    onMouseUp: onMouseUp,\n    onWheel: onWheel\n  };\n}\n;","map":{"version":3,"sources":["C:/Users/ASUS/Documents/Music/node_modules/rc-image/es/hooks/useMouseEvent.js"],"names":["_objectSpread","_slicedToArray","useState","useRef","useEffect","addEventListener","warning","getFixScaleEleTransPosition","BASE_SCALE_RATIO","WHEEL_MAX_SCALE_RATIO","useMouseEvent","imgRef","movable","visible","scaleStep","transform","updateTransform","dispatchZoomChange","rotate","scale","x","y","_useState","_useState2","isMoving","setMoving","startPositionInfo","diffX","diffY","transformX","transformY","onMouseDown","event","button","preventDefault","stopPropagation","current","pageX","pageY","onMouseMove","onMouseUp","_startPositionInfo$cu","hasChangedPosition","width","offsetWidth","height","offsetHeight","_imgRef$current$getBo","getBoundingClientRect","left","top","isRotate","fixState","onWheel","deltaY","scaleRatio","Math","abs","mergedScaleRatio","min","ratio","clientX","clientY","onTopMouseUpListener","onTopMouseMoveListener","onMouseUpListener","onMouseMoveListener","window","self","error","concat","_onMouseUpListener","_onMouseMoveListener","_onTopMouseUpListener","_onTopMouseMoveListen","remove"],"mappings":"AAAA,OAAOA,aAAP,MAA0B,0CAA1B;AACA,OAAOC,cAAP,MAA2B,0CAA3B;AACA,SAASC,QAAT,EAAmBC,MAAnB,EAA2BC,SAA3B,QAA4C,OAA5C;AACA,OAAOC,gBAAP,MAA6B,iCAA7B;AACA,SAASC,OAAT,QAAwB,oBAAxB;AACA,OAAOC,2BAAP,MAAwC,gCAAxC;AACA,SAASC,gBAAT,EAA2BC,qBAA3B,QAAwD,kBAAxD;AACA,eAAe,SAASC,aAAT,CAAuBC,MAAvB,EAA+BC,OAA/B,EAAwCC,OAAxC,EAAiDC,SAAjD,EAA4DC,SAA5D,EAAuEC,eAAvE,EAAwFC,kBAAxF,EAA4G;AACzH,MAAIC,MAAM,GAAGH,SAAS,CAACG,MAAvB;AAAA,MACEC,KAAK,GAAGJ,SAAS,CAACI,KADpB;AAAA,MAEEC,CAAC,GAAGL,SAAS,CAACK,CAFhB;AAAA,MAGEC,CAAC,GAAGN,SAAS,CAACM,CAHhB;;AAIA,MAAIC,SAAS,GAAGpB,QAAQ,CAAC,KAAD,CAAxB;AAAA,MACEqB,UAAU,GAAGtB,cAAc,CAACqB,SAAD,EAAY,CAAZ,CAD7B;AAAA,MAEEE,QAAQ,GAAGD,UAAU,CAAC,CAAD,CAFvB;AAAA,MAGEE,SAAS,GAAGF,UAAU,CAAC,CAAD,CAHxB;;AAIA,MAAIG,iBAAiB,GAAGvB,MAAM,CAAC;AAC7BwB,IAAAA,KAAK,EAAE,CADsB;AAE7BC,IAAAA,KAAK,EAAE,CAFsB;AAG7BC,IAAAA,UAAU,EAAE,CAHiB;AAI7BC,IAAAA,UAAU,EAAE;AAJiB,GAAD,CAA9B;;AAMA,MAAIC,WAAW,GAAG,SAASA,WAAT,CAAqBC,KAArB,EAA4B;AAC5C;AACA,QAAI,CAACpB,OAAD,IAAYoB,KAAK,CAACC,MAAN,KAAiB,CAAjC,EAAoC;AACpCD,IAAAA,KAAK,CAACE,cAAN;AACAF,IAAAA,KAAK,CAACG,eAAN;AACAT,IAAAA,iBAAiB,CAACU,OAAlB,GAA4B;AAC1BT,MAAAA,KAAK,EAAEK,KAAK,CAACK,KAAN,GAAcjB,CADK;AAE1BQ,MAAAA,KAAK,EAAEI,KAAK,CAACM,KAAN,GAAcjB,CAFK;AAG1BQ,MAAAA,UAAU,EAAET,CAHc;AAI1BU,MAAAA,UAAU,EAAET;AAJc,KAA5B;AAMAI,IAAAA,SAAS,CAAC,IAAD,CAAT;AACD,GAZD;;AAaA,MAAIc,WAAW,GAAG,SAASA,WAAT,CAAqBP,KAArB,EAA4B;AAC5C,QAAInB,OAAO,IAAIW,QAAf,EAAyB;AACvBR,MAAAA,eAAe,CAAC;AACdI,QAAAA,CAAC,EAAEY,KAAK,CAACK,KAAN,GAAcX,iBAAiB,CAACU,OAAlB,CAA0BT,KAD7B;AAEdN,QAAAA,CAAC,EAAEW,KAAK,CAACM,KAAN,GAAcZ,iBAAiB,CAACU,OAAlB,CAA0BR;AAF7B,OAAD,EAGZ,MAHY,CAAf;AAID;AACF,GAPD;;AAQA,MAAIY,SAAS,GAAG,SAASA,SAAT,GAAqB;AACnC,QAAI3B,OAAO,IAAIW,QAAf,EAAyB;AACvBC,MAAAA,SAAS,CAAC,KAAD,CAAT;AAEA;;AACA,UAAIgB,qBAAqB,GAAGf,iBAAiB,CAACU,OAA9C;AAAA,UACEP,UAAU,GAAGY,qBAAqB,CAACZ,UADrC;AAAA,UAEEC,UAAU,GAAGW,qBAAqB,CAACX,UAFrC;AAGA,UAAIY,kBAAkB,GAAGtB,CAAC,KAAKS,UAAN,IAAoBR,CAAC,KAAKS,UAAnD;AACA,UAAI,CAACY,kBAAL,EAAyB;AACzB,UAAIC,KAAK,GAAGhC,MAAM,CAACyB,OAAP,CAAeQ,WAAf,GAA6BzB,KAAzC;AACA,UAAI0B,MAAM,GAAGlC,MAAM,CAACyB,OAAP,CAAeU,YAAf,GAA8B3B,KAA3C,CAVuB,CAWvB;;AACA,UAAI4B,qBAAqB,GAAGpC,MAAM,CAACyB,OAAP,CAAeY,qBAAf,EAA5B;AAAA,UACEC,IAAI,GAAGF,qBAAqB,CAACE,IAD/B;AAAA,UAEEC,GAAG,GAAGH,qBAAqB,CAACG,GAF9B;;AAGA,UAAIC,QAAQ,GAAGjC,MAAM,GAAG,GAAT,KAAiB,CAAhC;AACA,UAAIkC,QAAQ,GAAG7C,2BAA2B,CAAC4C,QAAQ,GAAGN,MAAH,GAAYF,KAArB,EAA4BQ,QAAQ,GAAGR,KAAH,GAAWE,MAA/C,EAAuDI,IAAvD,EAA6DC,GAA7D,CAA1C;;AACA,UAAIE,QAAJ,EAAc;AACZpC,QAAAA,eAAe,CAAChB,aAAa,CAAC,EAAD,EAAKoD,QAAL,CAAd,EAA8B,aAA9B,CAAf;AACD;AACF;AACF,GAtBD;;AAuBA,MAAIC,OAAO,GAAG,SAASA,OAAT,CAAiBrB,KAAjB,EAAwB;AACpC,QAAI,CAACnB,OAAD,IAAYmB,KAAK,CAACsB,MAAN,IAAgB,CAAhC,EAAmC,OADC,CAEpC;;AACA,QAAIC,UAAU,GAAGC,IAAI,CAACC,GAAL,CAASzB,KAAK,CAACsB,MAAN,GAAe,GAAxB,CAAjB,CAHoC,CAIpC;;AACA,QAAII,gBAAgB,GAAGF,IAAI,CAACG,GAAL,CAASJ,UAAT,EAAqB9C,qBAArB,CAAvB,CALoC,CAMpC;;AACA,QAAImD,KAAK,GAAGpD,gBAAgB,GAAGkD,gBAAgB,GAAG5C,SAAlD;;AACA,QAAIkB,KAAK,CAACsB,MAAN,GAAe,CAAnB,EAAsB;AACpBM,MAAAA,KAAK,GAAGpD,gBAAgB,GAAGoD,KAA3B;AACD;;AACD3C,IAAAA,kBAAkB,CAAC2C,KAAD,EAAQ,OAAR,EAAiB5B,KAAK,CAAC6B,OAAvB,EAAgC7B,KAAK,CAAC8B,OAAtC,CAAlB;AACD,GAZD;;AAaA1D,EAAAA,SAAS,CAAC,YAAY;AACpB,QAAI2D,oBAAJ;AACA,QAAIC,sBAAJ;AACA,QAAIC,iBAAJ;AACA,QAAIC,mBAAJ;;AACA,QAAItD,OAAJ,EAAa;AACXqD,MAAAA,iBAAiB,GAAG5D,gBAAgB,CAAC8D,MAAD,EAAS,SAAT,EAAoB3B,SAApB,EAA+B,KAA/B,CAApC;AACA0B,MAAAA,mBAAmB,GAAG7D,gBAAgB,CAAC8D,MAAD,EAAS,WAAT,EAAsB5B,WAAtB,EAAmC,KAAnC,CAAtC;;AACA,UAAI;AACF;;AACA;AACA,YAAI4B,MAAM,CAACjB,GAAP,KAAeiB,MAAM,CAACC,IAA1B,EAAgC;AAC9BL,UAAAA,oBAAoB,GAAG1D,gBAAgB,CAAC8D,MAAM,CAACjB,GAAR,EAAa,SAAb,EAAwBV,SAAxB,EAAmC,KAAnC,CAAvC;AACAwB,UAAAA,sBAAsB,GAAG3D,gBAAgB,CAAC8D,MAAM,CAACjB,GAAR,EAAa,WAAb,EAA0BX,WAA1B,EAAuC,KAAvC,CAAzC;AACD;AACF,OAPD,CAOE,OAAO8B,KAAP,EAAc;AACd;AACA/D,QAAAA,OAAO,CAAC,KAAD,EAAQ,cAAcgE,MAAd,CAAqBD,KAArB,CAAR,CAAP;AACD;AACF;;AACD,WAAO,YAAY;AACjB,UAAIE,kBAAJ,EAAwBC,oBAAxB,EAA8CC,qBAA9C,EAAqEC,qBAArE;;AACA,OAACH,kBAAkB,GAAGN,iBAAtB,MAA6C,IAA7C,IAAqDM,kBAAkB,KAAK,KAAK,CAAjF,IAAsFA,kBAAkB,CAACI,MAAnB,EAAtF;AACA,OAACH,oBAAoB,GAAGN,mBAAxB,MAAiD,IAAjD,IAAyDM,oBAAoB,KAAK,KAAK,CAAvF,IAA4FA,oBAAoB,CAACG,MAArB,EAA5F;AACA;;AACA,OAACF,qBAAqB,GAAGV,oBAAzB,MAAmD,IAAnD,IAA2DU,qBAAqB,KAAK,KAAK,CAA1F,IAA+FA,qBAAqB,CAACE,MAAtB,EAA/F;AACA;;AACA,OAACD,qBAAqB,GAAGV,sBAAzB,MAAqD,IAArD,IAA6DU,qBAAqB,KAAK,KAAK,CAA5F,IAAiGA,qBAAqB,CAACC,MAAtB,EAAjG;AACD,KARD;AASD,GA7BQ,EA6BN,CAAC9D,OAAD,EAAUW,QAAV,EAAoBJ,CAApB,EAAuBC,CAAvB,EAA0BH,MAA1B,EAAkCN,OAAlC,CA7BM,CAAT;AA8BA,SAAO;AACLY,IAAAA,QAAQ,EAAEA,QADL;AAELO,IAAAA,WAAW,EAAEA,WAFR;AAGLQ,IAAAA,WAAW,EAAEA,WAHR;AAILC,IAAAA,SAAS,EAAEA,SAJN;AAKLa,IAAAA,OAAO,EAAEA;AALJ,GAAP;AAOD;AACD","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { useState, useRef, useEffect } from 'react';\nimport addEventListener from \"rc-util/es/Dom/addEventListener\";\nimport { warning } from \"rc-util/es/warning\";\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"../previewConfig\";\nexport default function useMouseEvent(imgRef, movable, visible, scaleStep, transform, updateTransform, dispatchZoomChange) {\n  var rotate = transform.rotate,\n    scale = transform.scale,\n    x = transform.x,\n    y = transform.y;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isMoving = _useState2[0],\n    setMoving = _useState2[1];\n  var startPositionInfo = useRef({\n    diffX: 0,\n    diffY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n  var onMouseDown = function onMouseDown(event) {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    startPositionInfo.current = {\n      diffX: event.pageX - x,\n      diffY: event.pageY - y,\n      transformX: x,\n      transformY: y\n    };\n    setMoving(true);\n  };\n  var onMouseMove = function onMouseMove(event) {\n    if (visible && isMoving) {\n      updateTransform({\n        x: event.pageX - startPositionInfo.current.diffX,\n        y: event.pageY - startPositionInfo.current.diffY\n      }, 'move');\n    }\n  };\n  var onMouseUp = function onMouseUp() {\n    if (visible && isMoving) {\n      setMoving(false);\n\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n      var _startPositionInfo$cu = startPositionInfo.current,\n        transformX = _startPositionInfo$cu.transformX,\n        transformY = _startPositionInfo$cu.transformY;\n      var hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) return;\n      var width = imgRef.current.offsetWidth * scale;\n      var height = imgRef.current.offsetHeight * scale;\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      var _imgRef$current$getBo = imgRef.current.getBoundingClientRect(),\n        left = _imgRef$current$getBo.left,\n        top = _imgRef$current$getBo.top;\n      var isRotate = rotate % 180 !== 0;\n      var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n      if (fixState) {\n        updateTransform(_objectSpread({}, fixState), 'dragRebound');\n      }\n    }\n  };\n  var onWheel = function onWheel(event) {\n    if (!visible || event.deltaY == 0) return;\n    // Scale ratio depends on the deltaY size\n    var scaleRatio = Math.abs(event.deltaY / 100);\n    // Limit the maximum scale ratio\n    var mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO);\n    // Scale the ratio each time\n    var ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n  useEffect(function () {\n    var onTopMouseUpListener;\n    var onTopMouseMoveListener;\n    var onMouseUpListener;\n    var onMouseMoveListener;\n    if (movable) {\n      onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n      onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n      try {\n        // Resolve if in iframe lost event\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n          onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, \"[rc-image] \".concat(error));\n      }\n    }\n    return function () {\n      var _onMouseUpListener, _onMouseMoveListener, _onTopMouseUpListener, _onTopMouseMoveListen;\n      (_onMouseUpListener = onMouseUpListener) === null || _onMouseUpListener === void 0 || _onMouseUpListener.remove();\n      (_onMouseMoveListener = onMouseMoveListener) === null || _onMouseMoveListener === void 0 || _onMouseMoveListener.remove();\n      /* istanbul ignore next */\n      (_onTopMouseUpListener = onTopMouseUpListener) === null || _onTopMouseUpListener === void 0 || _onTopMouseUpListener.remove();\n      /* istanbul ignore next */\n      (_onTopMouseMoveListen = onTopMouseMoveListener) === null || _onTopMouseMoveListen === void 0 || _onTopMouseMoveListen.remove();\n    };\n  }, [visible, isMoving, x, y, rotate, movable]);\n  return {\n    isMoving: isMoving,\n    onMouseDown: onMouseDown,\n    onMouseMove: onMouseMove,\n    onMouseUp: onMouseUp,\n    onWheel: onWheel\n  };\n}\n;"]},"metadata":{},"sourceType":"module"}